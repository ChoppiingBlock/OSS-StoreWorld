### 目录表（Directory Table）

| 字段名    | 类型         | 描述                             |
| --------- | ------------ | -------------------------------- |
| id        | INT          | 目录ID，主键                     |
| name      | VARCHAR(100) | 目录名称                         |
| parent_id | INT          | 父目录ID，外键指向目录表的id字段 |
| user_id   | INT          | 用户ID，外键指向用户表的id字段   |

```sql
CREATE TABLE directory_metadata (
    id INT PRIMARY KEY COMMENT '目录ID',
    name VARCHAR(100) NOT NULL COMMENT '目录名称',
    parent_id INT COMMENT '父目录ID',
    user_id INT COMMENT '用户ID',
    path VARCHAR(100) NOT NULL COMMENT '桶世界目录路径',
    createdate DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建日期',
    updateDate DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新日期',
    rowversion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '行版本号',
) COMMENT='目录信息';

```





我本来是想着用路径来做权限校验，但是发现很多情况下还是不免要搞双重循环，并且，如果优化的不好，如果父文件夹改名，子文件夹还修改不了。





### 文件表（File Table）

| 字段名       | 类型         | 描述                               |
| ------------ | ------------ | ---------------------------------- |
| id           | INT          | 文件ID，主键                       |
| name         | VARCHAR(100) | 文件名称                           |
| size         | BIGINT       | 文件大小                           |
| type         | VARCHAR(50)  | 文件类型                           |
| md5          | VARCHAR(32)  | 文件MD5哈希值                      |
| directory_id | INT          | 所在目录ID，外键指向目录表的id字段 |
| creator      | INT          | 创建者，外键指向用户表的id字段     |
| createdate   | DATETIME     | 创建日期                           |
| updateDate   | DATETIME     | 更新日期                           |
| rowversion   | TIMESTAMP    | 行版本号，用于乐观并发控制         |

shade_Param_m INT COMMENT '分片参数m',
    shade_Param_n INT COMMENT '分片参数n',

```sql
CREATE TABLE file_metadata (
    id INT PRIMARY KEY COMMENT '文件ID',
    name VARCHAR(100) NOT NULL COMMENT '文件名称',
    size BIGINT COMMENT '文件大小',
    type VARCHAR(50) COMMENT '文件类型',
    md5 VARCHAR(32) COMMENT '文件MD5哈希值',
    parent_id INT COMMENT '所在目录ID',
    path VARCHAR(100) NOT NULL COMMENT '桶世界目录路径',
    shade_type varchar(50) COMMENT '分片类型',
    shade_Param_m INT COMMENT '分片参数m',
    shade_Param_n INT COMMENT '分片参数n',
    creator INT COMMENT '创建者，外键指向用户表的id字段',
    createdate DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建日期',
    updateDate DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新日期',
    rowversion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '行版本号',
) COMMENT='文件信息';
```



### 文件分片映射表（File Shard Mapping Table）

| 字段名         | 类型         | 描述                                 |
| -------------- | ------------ | ------------------------------------ |
| id             | INT          | 分片ID，主键                         |
| file_id        | INT          | 文件ID，外键指向文件表的id字段       |
| shard_index    | INT          | 分片索引，标识文件分片的顺序         |
| shard_location | VARCHAR(255) | 分片位置信息，存储文件分片的具体位置 |

```sql
CREATE TABLE file_shard_mapping (
    id INT PRIMARY KEY COMMENT '分片ID',
    file_id INT COMMENT '文件ID，外键指向文件表的id字段',
    shard_index INT COMMENT '分片索引',
    shard_ip VARCHAR(255) COMMENT '分片服务ip',
    shard_port VARCHAR(255) COMMENT '分片服务port',
    shard_location VARCHAR(255) COMMENT '分片服务器文件位置',
    createdate DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建日期',
    updateDate DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新日期',
    rowversion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '行版本号'
) COMMENT='存储文件分片位置信息的表';
```





### USER

```sql
CREATE TABLE user (
                      id INT PRIMARY KEY AUTO_INCREMENT COMMENT '用户ID',
                      username VARCHAR(50) UNIQUE NOT NULL COMMENT '用户账号',
                      password VARCHAR(100) NOT NULL COMMENT '用户密码',
                          createdate DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建日期',
                      updateDate DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新日期',
                      rowversion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '行版本号'
) COMMENT='存储用户信息的表';

```





### 权限表设计

| 字段名          | 类型        | 描述                           |
| --------------- | ----------- | ------------------------------ |
| id              | INT         | 权限ID，主键                   |
| user_id         | INT         | 用户ID，外键指向用户表的id字段 |
| permission_code | VARCHAR(50) | 权限代号                       |
| permission_type | VARCHAR(50) | 权限类型                       |

```sql
CREATE TABLE permission (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '权限ID',
    user_id INT COMMENT '用户ID',
    permission_path VARCHAR(50) NOT NULL COMMENT '权限路径',
    permission_type VARCHAR(50) NOT NULL COMMENT '权限类型',
    createdate DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建日期',
    updateDate DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新日期',
    rowversion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '行版本号',
) COMMENT='存储权限信息的表';
```

